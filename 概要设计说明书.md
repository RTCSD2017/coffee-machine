
<center><font face="微软雅黑" size=5>自动咖啡机概要设计说明书</font></center>

<font face="微软雅黑">

# 1 引言

本项目主要完成自动咖啡机嵌入式软件的开发，需要团队合作，分工如下：

- 王振鸿：Cup_Storage模块
- 张世舜：Feeder模块
- 万学远：Conveyor_Belt；Mix模块
- 潘捷：Hot_Water模块
- 谢鑫磊：Doser模块
### 1.1编写目的

本文档用于指导自动咖啡机硬件及软件开发过程，与软件用户定义和明确软件的功能需求。本文档的目标读者为软件用户和软件开发项目组成员。

### 1.2背景

随着人们的生活节奏越来越快，某创业公司正设计一台自动咖啡机，已完成基本结构设计，需要开发咖啡机的嵌入式控制软件。

### 1.3定义
自动咖啡机能够按照用户的喜好制作出不同的咖啡，省去了自己冲泡咖啡的时间。
### 1.4参考资料

-	《构建之法》
-	Mathworks官方文档；

# 2总体设计


### 2.1 需求规定

需要提供三种咖啡，美式咖啡（沸水和咖啡粉），拿铁（咖啡粉，沸水，牛奶），卡布奇洛（咖啡粉，沸水，糖、牛奶）


### 2.2 运行环境

* Windows
* Matlab

### 2.3 模块设计
#### 2.3.1 模块1

##### 功能描述：自动提供空杯


##### 输入：两个光电传感器，开关信号。
##### 参数：cup_stock  ;  sensor1；switch。

##### 处理过程：当用户选择咖啡之后，若检测到库存是有空杯，且转盘下无空杯时，下落一个空杯。
##### 输出：motor1

#### 2.3.2 模块2

##### 功能描述：转盘转移空杯


##### 输入：两个光电传感器
##### 参数：sensor1；sensor2。

##### 处理过程：当sensor1检测到有空杯下落时，转盘转半周，转盘下落，复位。
##### 输出：motor2；cylinder1。


#### 2.3.3 模块3
##### 功能描述：传送带输送杯子


##### 输入：三个光电传感器
##### 参数：sensor2；sensor3；sensor4。

##### 处理过程：当sensor2检测到有空杯时，传送带运行，直到sensor3检测到空杯，停止转动，延时15s，继续运行，sensor4检测有空杯，传送带停止。
##### 输出：motor3。

#### 2.3.4 模块4

##### 功能描述：提供热水


##### 输入：一个光电传感器，开关信号。
##### 参数：sensor3，switch 。

##### 处理过程：当开关信号非零且sensor3检测到有空杯时，打开水泵和加热装置，延时10s，关闭所有装置。
##### 输出：pump；heating。
#### 2.3.5 模块5

##### 功能描述：提供配方


##### 输入：一个光电传感器，开关信号。
##### 参数：sensor3，switch 。

##### 处理过程：当开关信号非零且sensor3检测到有空杯时，根据不同的开关信号，打开不同的原料开关。
##### 输出：Milk；Sugar；Coffee。

#### 2.3.6 模块6

##### 功能描述：搅拌咖啡


##### 输入：一个光电传感器。
##### 参数：sensor3 。

##### 处理过程：当sensor3检测到有空杯时，打开搅拌电机，持续10s，打开龙头。
##### 输出：Mix1；Tap1 。
###2.4 各模块概要设计
####2.4.1 Feeder模块：（张世舜）
Feeder模块共有两个输入和两个输出接口，两个输入接口即为sensor1 和sensor2，两个输出为电机（motor2）和气缸（cylinder）。sensor1和sensor2分别有“0”、“1”两种状态分别对应前一阶段杯子是否落下和转盘转动后杯子是否到位，一开始sensor1=0，进入电机的OFF状态，通过sensor1=1这一条件转移指令来决定电机motor2从off到on的状态，通过sensor2=1决定电机从on回到off（off2）并以此时的motor2=0为新的条件转移指令，延迟1s后使气缸Cylinder=1，即：使得气缸到达最大行程状态，带动整个转盘下移。使气缸最大行程状态保持3秒,由after（3，sec）指令,使Cylinder=0，即气缸回到最小行程，转盘复位，整个过程完成。

####2.4.2 Conveyor_Belt模块：（万学远）
Conveyor_Belt模块有三个输入接口和一个输出接口，输入接口分别为sensor2，sensor3和sensor4 。输出为motor3，控制传送带电机。三个传感器接口跟踪杯子的位置，sensor2为1时表示空杯以到传送带下，传送带开始运行motor3=1，sensor3为1时表示杯子达到了龙头下，传送带停止motor3=0，延时10s，等转满咖啡之后，继续运行，motor3=1；直到sensor4=1，表示杯子已经达到取杯处，传送带停止，motor3=0 。

###2.4.3 Hot_Water模块：（潘捷）
Button：电源按钮，控制装置的On和Off；
Button置1，装置电源接通；反之关闭；
Sensor3：检测杯子是否到达Brewing Assembly下方。若达到后，sensor3置1；
        Heating和Pumb装置接收到sensor3置1后 ，开启；延时一定时间后自动关闭；（延时起控制容量的作用）。

###2.4.4 Doser模块：（谢鑫磊）
拥有两个大状态，上电的待机状态和待机状态，通过上电信号0和1进行控制。在待机状态拥有三个子状态，分别控制三种液体的释放，三种过程相同，以咖啡为例子，释放过程通过延时10s进行，通过杯子到位传感器sensor3进行上升沿触发 ，判断是否有液体senor4进行与逻辑判断是否从OFF状态进入ON状态，ON状态打开液体开关，OFF关闭。ON状态从sensor4是否为0或者10s延迟再进入OFF状态，三种液体为并联的关系。接口同上次中一样。

###2.4.5 Mix模块：（万学远）
Mix模块有一个输入两个输出接口，输入接口为Pump是Hot_Water模块的输出；输出模块为Mix和open，分别控制搅拌电机和龙头开关。当Pump输出由1变为0时，表示热水加入完毕，打开Mix=1进行搅拌，延时2s，然后关闭搅拌机Mix=0；打开龙头open=0；延时3s，将咖啡放入空杯。然后关闭整个模块。


# 3 接口设计
### 3.1用户接口

三个选择咖啡的按钮，一个开关按钮，取杯口。

### 3.2 外部接口

无

### 3.3 内部接口

模块之间采用信号传递，传感器信号传递。
# 4 运行设计
### 4.1 运行模块组合

系统是以基于simulink的开发工具下开发完成

### 4.2 运行控制

当用户按下按钮后，Cup_Storage放下一空杯到转盘，Feeder将空杯转移到传送带，Conveyor_Belt将空杯转移到龙头下，Hot_Water模块开始提供热水，同时Doser模块根据用户的选择按配方提供原料，Mix模块进行咖啡搅拌，之后打开龙头，传送带继续运行将咖啡运送到取杯口。

### 4.3 运行时间

5分钟



### 6 系统出错处理设计
### 6.1 出错信息

当Cup_Storage检测到空杯用完；Doser模块检测到原料用完等时候会发出错误信号并且停止机器运行。

### 6.2 补救措施
出现错误会点亮警告灯并且停止机器工作






</font>
